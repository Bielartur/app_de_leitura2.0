{% extends 'base.html' %}
{% load static %}
{% load cards %}

{% block title %}
    Dashboard
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/card.css' %}">
{% endblock %}

{% block class_body %} bg-[var(--light-body)] {% endblock %}

{% block body %}
    {% include 'includes/navbar.html' %}
    <main class="flex-1">
        <section class="py-8 w-full max-w-6xl mx-auto mb-4 flex flex-col items-center justify-center gap-4 px-4 xl:px-0">
            <div class="text-center fade-in" style="opacity: 0; transform: none;">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold text-gradient mb-4">
                        Sua Jornada de Leitura
                    </h1>
                </div>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto">
                    Acompanhe seu progresso, mantenha a consistência e alcance suas metas de leitura
                </p>
            </div>

            <div class="w-full py-4 grid grid-cols-[repeat(auto-fit,_minmax(16rem,_1fr))] gap-5">
              {% dash_card    'mes'    qtd=dashboard.progresso_meta_mensal.lidas pct_concluida=dashboard.progresso_meta_mensal.pct %}

              {% dash_card 'sequencia' qtd=dashboard.dias_consecutivos %}

              {% dash_card 'andamento' qtd=dashboard.qtd_livros_ativos add_livro=True %}
            </div>

            <div class="p-6 pb-2 flex flex-col flex-grow gap-2 bg-white text-slate-600 shadow-md rounded-xl w-full fade-in"
                 style="animation-delay: 0.4s">

                <div class="w-full min-h-18 flex justify-between">
                    <div>
                        <div class="flex items-center flex-wrap">
                            <div class="bg-indigo-100 w-10 h-10 rounded-lg text-indigo-500 text-xl flex items-center justify-center mr-3">
                                <i class="fa-regular fa-calendar"></i>
                            </div>
                            <div class="h-full flex flex-col justify-between">
                                <h2 class="font-semibold text-xl text-slate-800">Progresso Mensal</h2>
                                <p class="text-sm text-slate-500">Agosto 2025</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end">
                        <p class="text-sm text-slate-500 whitespace-nowrap">
                            <i class="fa-solid fa-bullseye"></i>
                            <span>Meta: {{ request.user.meta_mensal_efetiva|default:0 }} páginas</span>
                        </p>
                        <strong class="text-slate-800 text-2xl">{{ dashboard.progresso_meta_mensal.lidas }} / {{ request.user.meta_mensal_efetiva|default:0 }}</strong>
                    </div>
                </div>

                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center mt-2">
                        <p class="text-sm text-slate-600 font-semibold">Progresso da meta</p>
                        <strong class="text-sm text-semibold text-[var(--great-green)]">{{ dashboard.progresso_meta_mensal.pct }}%</strong>
                    </div>
                    <div class="w-full h-[0.8rem] rounded-full bg-gray-200">
                        <div class="h-full rounded-full relative overflow-hidden fill" style="--target: {{ dashboard.progresso_meta_mensal.pct }}%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-[0.75rem] text-slate-500">Faltam 153 páginas</p>
                        <p class="text-[0.75rem] text-slate-500">51 páginas/dia restantes</p>
                    </div>
                </div>

                <div class="w-full h-64 sm:h-72 mt-3">
                    <p class="text-slate-600 font-semibold">Páginas por Dia</p>
                    <div id="bar-chart"></div>
                </div>

            </div>
        </section>

        <section class="mb-12 max-w-6xl mx-auto px-4 fade-in xl:px-0"
                 style="opacity: 0; transform: none; animation-delay: 0.5s">
            <div class="flex items-center justify-between gap-4 mb-6">
                <h2 class="text-2xl font-bold text-slate-800">
                    Livros em Andamento
                </h2>
                <button id="openModalBtn2"
                        class="flex items-center space-x-2 px-4 py-2
                       bg-gradient-to-r from-[var(--great-green)] to-[var(--mid-blue)]
                       text-white rounded-xl
                       hover:brightness-110
                       transition duration-300 ease-in-out cursor-pointer"
                >
                    <i class="fa-solid fa-plus"></i>
                    <span class="whitespace-nowrap">Novo Livro</span>
                </button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">

                {% for user_book in livros_em_andamento %}

                {% include 'livros/includes/card_livro_andamento.html' with livro=user_book.livro %}

                {% endfor %}

            </div>
        </section>

        <section class="pb-8 max-w-6xl mx-auto px-4 fade-in xl:px-0"
                 style="opacity: 0; transform: none; animation-delay: 0.8s;">
            <div class="flex items-center justify-between gap-4 mb-6">
                <h2 class="text-2xl font-bold text-slate-800">
                    Concluídos Recentemente
                </h2>
                <a class="text-[var(--great-green)] hover:text-[var(--mid-blue)] font-medium transition-colors whitespace-nowrap"
                   href="{% url 'livros:concluidos' %}">
                    Ver todos →
                </a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

                {% include 'livros/includes/card_concluidos_recentemente.html' with titulo="O Homem Mais Rico da Babilônia" autor="George S. Clason" qtd_estrelas=5 data_conclusao="09/01/2024" url_img="https://images.pexels.com/photos/1029141/pexels-photo-1029141.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=300" %}

                {% include 'livros/includes/card_concluidos_recentemente.html' with titulo="Mindset" autor="Carol Dweck" qtd_estrelas=4 data_conclusao="04/01/2024" url_img="https://images.pexels.com/photos/1370295/pexels-photo-1370295.jpeg?auto=compress&cs=tinysrgb&w=300" %}

            </div>
        </section>
    </main>

    {% include  'includes/modal_add_livro.html' %}

{% endblock %}

{% block script %}
    {{ dashboard.diario|json_script:"diario-json" }}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="{% static 'js/abrirModalLivro.js' %}"></script>
    <script src="{% static 'js/gerarGrafico.js' %}"></script>

{% endblock %}